<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Responsive Admin Dashboard Template">
    <meta name="keywords" content="admin,dashboard">
    <meta name="author" content="skcats">
    <!-- Title -->
    <title>看护</title>
    <!--亲属查看预约通知单-->
    <!-- Styles -->
   <!-- <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/plugins/icomoon/style.css" rel="stylesheet">
    <link href="assets/plugins/uniform/css/default.css" rel="stylesheet"/>
    <link href="assets/plugins/switchery/switchery.min.css" rel="stylesheet"/>
    <link href="assets/plugins/datatables/css/jquery.datatables.min.css" rel="stylesheet" type="text/css"/>
    <link href="assets/plugins/datatables/css/jquery.datatables_themeroller.css" rel="stylesheet" type="text/css"/>
    <link href="assets/plugins/bootstrap-datepicker/css/datepicker3.css" rel="stylesheet" type="text/css"/>

    &lt;!&ndash; Theme Styles &ndash;&gt;
    <link href="assets/css/ecaps.min.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">-->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Javascripts -->
    <!--引入css-->
    <div th:include="common_jscss :: #commonscript_css"><!--id声明的--></div>

</head>
<body>

<!-- Page Container -->
<div class="page-container">
    <!-- Page Sidebar，，左侧菜单栏 -->
    <div th:replace="common_caregiver :: #leftmenu"></div><!-- /Page Sidebar 左侧菜单栏结束-->
    <!-- Page Content -->
    <div class="page-content">
        <!-- Page Header 页面顶部导航栏-->
        <div th:replace="common_caregiver :: #headermenu"></div><!--公共内容抽取--><!-- /Page Header 页面顶部导航栏-->

        <!-- Page Inner -->
        <div class="page-inner">
            <div class="page-title">
                <h3 class="breadcrumb-header">处理预约申请</h3>
            </div>
            <div id="main-wrapper">
                <div class="row">
                    <div class="col-md-12">
                        <!--数据表格-->
                        <div class="panel panel-white">
                            <div class="panel-heading">
                                <!--<h4 class="panel-title">Add rows</h4>-->
                            </div>
                            <div class="panel-body"><!--模态框(modal) 触发事件(data-toggle) 触发对象data-target(ID 或类)--
                                <!-- Modal -->
                                <!-- Modal添加数据表单 -->
                                <form id="add-row-form" action="javascript:void(0);"><!--添加老人数据表单-->
                                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                    <h4 class="modal-title" id="myModalLabel">添加老人信息</h4>
                                                </div>
                                                <div class="modal-body">
                                                   <!-- <div class="form-group">
                                                        我的编号：
                                                        <input type="text" id="no" class="form-control" placeholder="我的编号" th:value="${session.info.relativesSerialnumber}" required readonly>
                                                    </div>-->
                                                    <div class="form-group">
                                                        <input type="text" id="oldmanIdnumber" class="form-control" placeholder="请输入老人身份证号" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <input type="text" id="oldmanrelative" class="form-control" placeholder="请输入您与老人关系" required>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                    <button type="submit" id="add-row-relativeoldman" class="btn btn-success" onclick="javascript:return insertinfo()">添加</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form><!--添加数据表单结束-->
                                <!--编辑收据表单-->
                                <form id="add-row-form2" action="javascript:void(0);">
                                    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                    <h4 class="modal-title" id="myModalLabel2">预约看望老人</h4>
                                                </div>
                                                <div class="modal-body">
                                                   <!-- <div class="form-group">
                                                        我的编号：
                                                        <input type="text" id="no2" class="form-control" placeholder="我的编号" th:value="${session.info.relativesSerialnumber}" required readonly>
                                                    </div>-->
                                                    <div class="form-group">
                                                        老人编号：
                                                        <input type="text" id="oldmanbianhao" class="form-control" placeholder="老人编号" required readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        老人姓名：
                                                        <input type="text" id="oldmanname" class="form-control" placeholder="老人姓名" required readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        预约时间：
                                                        <input type="text" id="visitappointmentDate" class="form-control date-picker" placeholder="请输入预约时间" required>
                                                    </div>
                                                    <div class="form-group">
                                                        备注：
                                                        <input type="text" id="visitappointmentRemark" class="form-control" placeholder="备注" required>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                    <button type="submit" id="add-row-relativeoldman2" class="btn btn-success" onclick="javascript:return insertvisitinfo()">预约</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form><!--编辑数据表单结束-->
                                <div class="table-responsive">
                                    <table id="example3" class="display table" style="width: 100%; cellspacing: 0;">
                                        <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>编号</th>
                                            <th>老人编号</th>
                                            <th>老人姓名</th>
                                            <th>身份证号</th>
                                            <th>亲属关系</th>
                                            <th>预约时间</th>
                                            <th>申请时间</th>
                                            <th>备注信息</th>
                                            <th>负责人编号</th>
                                            <th>负责人联系方式</th>
                                            <th>处理状态</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tfoot>
                                        <tr>
                                            <th>序号</th>
                                            <th>编号</th>
                                            <th>老人编号</th>
                                            <th>老人姓名</th>
                                            <th>身份证号</th>
                                            <th>亲属关系</th>
                                            <th>预约时间</th>
                                            <th>申请时间</th>
                                            <th>备注信息</th>
                                            <th>负责人编号</th>
                                            <th>负责人联系方式</th>
                                            <th>处理状态</th>
                                            <th>操作</th>
                                        </tr>
                                        </tfoot>
                                        <tbody>
                                        <!--list数组放入，遍历EspOldmaninfos，每一个都是EspOldmaninfo对象,stats是当前的状态-->
                                        <tr th:each="info,status:${modelinfo}"><!--前一个可以自己起名--><!--status为当前状态-->
                                            <th th:text="${status.count}">序号</th><!--计数，index从0开始，count从1开始-->
                                            <th th:text="${info.visitappointmentId}">编号</th>
                                            <th th:text="${info.oldmaninfo.oldmanSerialnumber}">老人编号</th>
                                            <th th:text="${info.oldmaninfo.oldmanName}">老人姓名</th>
                                            <th th:text="${info.oldmaninfo.oldmanIdnumber}">身份证号</th>
                                            <th th:text="${info.ror}">亲属关系</th>
                                            <th th:text="${info.visitappointmentDate}">预约时间</th>
                                            <th th:text="${info.visitappointmentCreatedate}">申请时间</th>
                                            <th th:text="${info.visitappointmentRemark}">备注信息</th>
                                            <th th:text="${info.oldmaninfo.caregiverinfo.caregiverEmpno}">负责人编号</th>
                                            <th th:text="${info.oldmaninfo.caregiverinfo.caregiverPhone}">负责人联系方式</th>
                                            <th th:text="${info.visitappointmentState}">处理状态</th><!--data-toggle="modal" data-target="#myModal",增加此触发模态框-->
                                            <!--向模态框中传值-->
                                                <th>
                                                   <!-- <a href="" th:onclick="insertVisit([[${info.oldmaninfo.oldmanSerialnumber}]],[[${info.oldmaninfo.oldmanName}]])" data-toggle="modal" data-target="#myModal2"><i class="fa fa-close" aria-hidden="true"></i> <span class="sr-only">Example of </span>预约看望</a>-->
                                                <a href="" th:onclick="return Agree([[${info.visitappointmentId}]],[[${info.visitappointmentRemark}]])"><i class="fa fa-cog" aria-hidden="true"></i> <span class="sr-only">Example of </span>同意 </a><!--<span class="text-muted">(alias)</span>-->
                                                    <a href="" th:onclick="return Denial([[${info.visitappointmentId}]],[[${info.visitappointmentRemark}]])"><i class="fa fa-close" aria-hidden="true"></i> <span class="sr-only">Example of </span>拒绝 </a><!--<span class="text-muted">(alias)</span>-->
                                            <!--可以通过no后面取页面中的值进行提交,,pn=${oldmaninfo.current}获取当前页的页码,pn=${oldmaninfo.current},分页暂时不可用-->
                                            </th>
                                            <!--<td>[[oldmaninfos.oldmanid]]</td><!--行内写法-->
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div><!--数据表格结束-->
                    </div>
                </div><!-- Row -->
            </div><!-- Main Wrapper -->
            <!--页脚防伪标识-->
            <div th:replace="common_office :: #page_footer_ssd"></div><!--标识结束-->
        </div><!-- /Page Inner -->
        <!--右侧聊天框界面-->
        <div th:replace="common_office :: #right_sidebar"></div><!--公共内容抽取-->
        <!--右侧聊天框-->
    </div><!-- /Page Content -->
</div><!-- /Page Container -->

<!--同意申请-->
<script>
    //拒绝申请
    function Denial(visitappointmentId,visitappointmentRemark) {
        var msg = prompt("您确定要拒绝此预约吗？ 是否要输入备注信息","无");
        var visitappointmentState ="已拒绝";
        // alert("进入拒绝操作");
        if (msg!=null && msg!="")
        {
            //设置拒绝
            $.ajax({
                url: "/update/state/Visitappointment",
                type: "POST",//方法类型
                data: {
                    visitappointmentId:visitappointmentId,
                    visitappointmentRemark: msg,
                    visitappointmentState:visitappointmentState,
                },
                success: function(data) {
                    alert(data.msgCode+data.message);/*成功获取到数据*/
                    location.reload();
                },
                error: function(data) {
                    alert("未知错误");
                }
            });
        }else{
            return false;
        }
    }
    //同意申请
    function Agree(visitappointmentId,visitappointmentRemark) {
        var msg = prompt("您确定要同意此预约吗？ 是否要输入备注信息","无");
        var visitappointmentState ="已同意";
        // alert("进入同意操作");
        if (msg!=null && msg!="")
        {
            //设置拒绝
            $.ajax({
                url: "/update/state/Visitappointment",
                type: "POST",//方法类型
                data: {
                    visitappointmentId:visitappointmentId,
                    visitappointmentRemark: msg,
                    visitappointmentState:visitappointmentState,
                },
                success: function(data) {
                    alert(data.msgCode+data.message);/*成功获取到数据*/
                    location.reload();
                },
                error: function(data) {
                    alert("未知错误");
                }
            });
        }else{
            return false;
        }
    }
</script>
<script>
    //添加亲属关系
    function insertinfo() {
        var no = $('#no').val(),
            oldmanIdnumber = $('#oldmanIdnumber').val(),
            oldmanrelative = $('#oldmanrelative').val();
        $.ajax({
            cache: false,//每次读取的是最新的数据。
            url: "/insert/relativesoldmanrelative",
            type: "POST",//方法类型
            clearForm: true,// 成功提交后，清除所有的表单元素的值.
            data: {
                no: no,
                oldmanIdnumber: oldmanIdnumber,
                oldmanrelative: oldmanrelative,
            },
            success: function (data) {
                alert(data.msgCode + data.message);
                /*成功获取到数据*/
                location.reload();
            },
            error: function (data) {
                alert(data.msgCode + data.message);
                location.reload();
            }
        });
    }
    //预约看望老人
    function insertvisitinfo() {
        alert("进行预约操作");
        var relativesno = $('#no2').val(),//获取亲属编号
            oldmanSerialnumber = $('#oldmanbianhao').val(),
            visitappointmentDate = $('#visitappointmentDate').val(),
            visitappointmentRemark = $('#visitappointmentRemark').val();
        $.ajax({
            cache: false,//每次读取的是最新的数据。
            url: "/insert/Visitappointment",
            type: "POST",//方法类型
            clearForm: true,// 成功提交后，清除所有的表单元素的值.
            data: {
                relativesno: relativesno,
                oldmanSerialnumber: oldmanSerialnumber,
                visitappointmentDate: visitappointmentDate,
                visitappointmentRemark: visitappointmentRemark,
            },
            success: function (data) {
                alert(data.msgCode + data.message);
                /*成功获取到数据*/
                location.reload();
            },
            error: function (data) {
                alert("出现错误");
                location.reload();
            }
        });
    }
</script>

<!--自己写的js-->
<script>
    /*删除按钮*/
    function del(rorId) {
        var msg = "您真的确定要取消绑定关系吗？\n\n请确认！";
        if (confirm(msg)==true){
            /*获取no*/
            $.ajax({
                url: "/delete/relativesoldmanrelative",
                type: "POST",//方法类型
                data: {
                    no: rorId,
                },
                success: function(data) {
                    alert(data.msgCode+data.message);/*成功获取到数据*/
                    location.reload();
                },
                error: function(data) {
                    alert("未知错误");
                }
            });
        }else{
            return false;
        }
    }

    /**
     * 模态框传值
     */
    function insertVisit(oldmanSerialnumber,oldmanName) {
        $("#oldmanbianhao").val(oldmanSerialnumber);
        $("#oldmanname").val(oldmanName);
    }

</script>

<!--引入js-->
<div th:include="common_jscss :: #commonscript_js"><!--id声明的--></div>
</body>
</html>